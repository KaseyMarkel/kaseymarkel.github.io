<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BC Operational & Agronomic Metrics Dashboard</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/recharts@2.12.7/dist/Recharts.js"></script>
    <script src="https://unpkg.com/prop-types@15.8.1/prop-types.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');

        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }

        .glass-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 16px;
            border: 1px solid rgba(255, 255, 255, 0.3);
            box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.15);
        }

        .metric-card {
            transition: all 0.3s ease;
        }

        .metric-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 12px 40px 0 rgba(31, 38, 135, 0.25);
        }

        .status-green { color: #10b981; }
        .status-yellow { color: #f59e0b; }
        .status-red { color: #ef4444; }

        .bg-status-green { background-color: #d1fae5; }
        .bg-status-yellow { background-color: #fef3c7; }
        .bg-status-red { background-color: #fee2e2; }

        .funnel-bar {
            height: 40px;
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            border-radius: 8px;
            transition: all 0.3s ease;
        }

        .refresh-btn {
            animation: spin 2s linear infinite;
        }

        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        .filter-chip {
            transition: all 0.2s ease;
        }

        .filter-chip:hover {
            transform: scale(1.05);
        }

        .filter-chip.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo } = React;
        const { BarChart, Bar, LineChart, Line, PieChart, Pie, Cell, XAxis, YAxis, CartesianGrid, Tooltip, Legend, ResponsiveContainer, FunnelChart, Funnel, LabelList } = Recharts;

        // BMS API Configuration
        const BMS_API_CONFIG = {
            baseUrl: 'https://bmspro.io/api',
            // Add your BMS API credentials here
            apiKey: 'YOUR_BMS_API_KEY',
            programId: 'YOUR_PROGRAM_ID'
        };

        // Mock data structure matching BMS schema
        const generateMockData = () => {
            const locations = ['Station BC', 'Oriente', 'Estaci√≥n'];
            const schemes = ['QPM', 'Zn', 'Zn+QPM'];
            const stages = ['BC1F1', 'BC2F1', 'BC3F1'];

            return {
                funnelData: [
                    { name: 'Seeds Planted', value: 12500, target: 12000, efficiency: 104 },
                    { name: 'Plants at V4-V6', value: 10800, target: 10200, efficiency: 106 },
                    { name: 'Plants Sampled', value: 10500, target: 10200, efficiency: 103 },
                    { name: 'Valid Genotypes', value: 9850, target: 9800, efficiency: 101 },
                    { name: 'Plants Selected', value: 3200, target: 3000, efficiency: 107 },
                    { name: 'Plants Pollinated', value: 3050, target: 3000, efficiency: 102 },
                    { name: 'Successful Ears (>30k)', value: 2850, target: 2700, efficiency: 106 },
                    { name: 'Ears Harvested', value: 2780, target: 2700, efficiency: 103 },
                ],
                rateMetrics: [
                    { name: 'Emergence Rate', value: 86.4, threshold: 80, status: 'green' },
                    { name: 'V4-V6 Survival', value: 86.4, threshold: 85, status: 'green' },
                    { name: 'Sampling Rate', value: 97.2, threshold: 95, status: 'green' },
                    { name: 'Valid Genotype Rate', value: 93.8, threshold: 90, status: 'green' },
                    { name: 'Pollination Success', value: 93.4, threshold: 85, status: 'green' },
                    { name: 'Rot Loss Rate', value: 2.4, threshold: 5, status: 'green', inverse: true },
                    { name: 'Lab Eval Rate', value: 98.2, threshold: 95, status: 'green' },
                    { name: 'Lab Pass Rate', value: 96.5, threshold: 90, status: 'green' },
                ],
                coverageMetrics: [
                    { scheme: 'QPM BC1F1', required: 800, available: 920, ratio: 1.15, status: 'green' },
                    { scheme: 'QPM BC2F1', required: 650, available: 720, ratio: 1.11, status: 'green' },
                    { scheme: 'Zn BC1F1', required: 600, available: 680, ratio: 1.13, status: 'green' },
                    { scheme: 'Zn BC2F1', required: 550, available: 540, ratio: 0.98, status: 'red' },
                    { scheme: 'Zn+QPM BC1F1', required: 450, available: 520, ratio: 1.16, status: 'green' },
                    { scheme: 'Zn+QPM BC2F1', required: 350, available: 360, ratio: 1.03, status: 'yellow' },
                ],
                speedMetrics: [
                    { stage: 'Planting ‚Üí Sampling', days: 35, target: 40, status: 'green' },
                    { stage: 'Sampling ‚Üí Genotyping', days: 12, target: 14, status: 'green' },
                    { stage: 'Genotyping ‚Üí Next Planting', days: 18, target: 21, status: 'green' },
                    { stage: 'Total Cycle Time', days: 65, target: 75, status: 'green' },
                ],
                topIssues: [
                    { rank: 1, issue: 'Spiroplasma (Virus)', impact: 'High', plants: 450, pct: 4.2, trend: 'stable' },
                    { rank: 2, issue: 'Climate/Temperature Stress', impact: 'High', plants: 380, pct: 3.5, trend: 'increasing' },
                    { rank: 3, issue: 'Pollination Effectiveness', impact: 'Medium', plants: 200, pct: 6.6, trend: 'stable' },
                    { rank: 4, issue: 'Ear Mold Diseases', impact: 'Medium', plants: 168, pct: 6.0, trend: 'decreasing' },
                    { rank: 5, issue: 'Germination Issues', impact: 'Low', plants: 160, pct: 1.3, trend: 'stable' },
                ],
                stackProgress: [
                    { level: 'Zn+QPM ‚â•60%', count: 245, target: 200 },
                    { level: 'Zn+QPM ‚â•70%', count: 156, target: 120 },
                    { level: 'Zn+QPM ‚â•80% + o2', count: 42, target: 40 },
                ],
                cycleTimeHistory: [
                    { cycle: 'C1', total: 72, sampling: 38, genotyping: 14, planning: 20 },
                    { cycle: 'C2', total: 68, sampling: 36, genotyping: 13, planning: 19 },
                    { cycle: 'C3', total: 65, sampling: 35, genotyping: 12, planning: 18 },
                    { cycle: 'Current', total: 65, sampling: 35, genotyping: 12, planning: 18 },
                ],
                lastUpdated: new Date().toISOString()
            };
        };

        // Main Dashboard Component
        const Dashboard = () => {
            const [data, setData] = useState(generateMockData());
            const [loading, setLoading] = useState(false);
            const [filters, setFilters] = useState({
                location: 'All',
                scheme: 'All',
                stage: 'All',
                dateRange: '30d'
            });
            const [autoRefresh, setAutoRefresh] = useState(false);

            // BMS API Integration
            const fetchBMSData = async () => {
                setLoading(true);
                try {
                    // Real BMS API calls would go here
                    // const response = await fetch(`${BMS_API_CONFIG.baseUrl}/trials`, {
                    //     headers: { 'Authorization': `Bearer ${BMS_API_CONFIG.apiKey}` }
                    // });
                    // const bmsData = await response.json();

                    // For now, using mock data
                    setTimeout(() => {
                        setData(generateMockData());
                        setLoading(false);
                    }, 1000);
                } catch (error) {
                    console.error('Error fetching BMS data:', error);
                    setLoading(false);
                }
            };

            useEffect(() => {
                fetchBMSData();
            }, [filters]);

            useEffect(() => {
                if (autoRefresh) {
                    const interval = setInterval(fetchBMSData, 300000); // 5 minutes
                    return () => clearInterval(interval);
                }
            }, [autoRefresh]);

            const getStatusColor = (status) => {
                return status === 'green' ? 'status-green' :
                       status === 'yellow' ? 'status-yellow' : 'status-red';
            };

            const getStatusBg = (status) => {
                return status === 'green' ? 'bg-status-green' :
                       status === 'yellow' ? 'bg-status-yellow' : 'bg-status-red';
            };

            const COLORS = ['#10b981', '#f59e0b', '#ef4444', '#667eea', '#764ba2'];

            return (
                <div className="min-h-screen p-6">
                    <div className="max-w-7xl mx-auto space-y-6">
                        {/* Header */}
                        <div className="glass-card p-6">
                            <div className="flex justify-between items-center flex-wrap gap-4">
                                <div>
                                    <h1 className="text-3xl font-bold text-gray-800 mb-2">
                                        <i className="fas fa-seedling mr-3 text-purple-600"></i>
                                        BC Operational & Agronomic Metrics
                                    </h1>
                                    <p className="text-gray-600">Real-time breeding program performance dashboard</p>
                                </div>
                                <div className="flex gap-3 items-center">
                                    <button
                                        onClick={fetchBMSData}
                                        className="px-4 py-2 bg-gradient-to-r from-purple-600 to-indigo-600 text-white rounded-lg hover:shadow-lg transition-all"
                                        disabled={loading}
                                    >
                                        <i className={`fas fa-sync-alt mr-2 ${loading ? 'refresh-btn' : ''}`}></i>
                                        Refresh
                                    </button>
                                    <button
                                        onClick={() => setAutoRefresh(!autoRefresh)}
                                        className={`px-4 py-2 rounded-lg transition-all ${
                                            autoRefresh
                                                ? 'bg-green-500 text-white'
                                                : 'bg-gray-200 text-gray-700 hover:bg-gray-300'
                                        }`}
                                    >
                                        <i className="fas fa-clock mr-2"></i>
                                        Auto-refresh {autoRefresh ? 'ON' : 'OFF'}
                                    </button>
                                    <div className="text-sm text-gray-600">
                                        Last updated: {new Date(data.lastUpdated).toLocaleTimeString()}
                                    </div>
                                </div>
                            </div>

                            {/* Filters */}
                            <div className="mt-6 flex gap-3 flex-wrap">
                                {['All', 'Station BC', 'Oriente', 'Estaci√≥n'].map(loc => (
                                    <button
                                        key={loc}
                                        onClick={() => setFilters({...filters, location: loc})}
                                        className={`filter-chip px-4 py-2 rounded-full ${
                                            filters.location === loc ? 'active' : 'bg-gray-200 text-gray-700'
                                        }`}
                                    >
                                        {loc}
                                    </button>
                                ))}
                                <div className="border-l border-gray-300 mx-2"></div>
                                {['All', 'QPM', 'Zn', 'Zn+QPM'].map(scheme => (
                                    <button
                                        key={scheme}
                                        onClick={() => setFilters({...filters, scheme: scheme})}
                                        className={`filter-chip px-4 py-2 rounded-full ${
                                            filters.scheme === scheme ? 'active' : 'bg-gray-200 text-gray-700'
                                        }`}
                                    >
                                        {scheme}
                                    </button>
                                ))}
                            </div>
                        </div>

                        {/* Block A: Funnel Metrics */}
                        <div className="glass-card p-6">
                            <h2 className="text-2xl font-semibold text-gray-800 mb-4">
                                <i className="fas fa-filter mr-2 text-purple-600"></i>
                                Block A: Pipeline Funnel
                            </h2>
                            <div className="space-y-3">
                                {data.funnelData.map((item, idx) => (
                                    <div key={idx} className="flex items-center gap-4">
                                        <div className="w-48 text-sm font-medium text-gray-700">{item.name}</div>
                                        <div className="flex-1">
                                            <div className="relative h-10 bg-gray-100 rounded-lg overflow-hidden">
                                                <div
                                                    className="funnel-bar absolute top-0 left-0 h-full flex items-center justify-between px-4"
                                                    style={{width: `${(item.value / data.funnelData[0].value) * 100}%`}}
                                                >
                                                    <span className="text-white font-semibold text-sm">{item.value.toLocaleString()}</span>
                                                    <span className="text-white text-xs">{item.efficiency}%</span>
                                                </div>
                                            </div>
                                        </div>
                                        <div className="w-32 text-right">
                                            <span className="text-xs text-gray-500">Target: {item.target.toLocaleString()}</span>
                                        </div>
                                    </div>
                                ))}
                            </div>
                        </div>

                        {/* Block B: Rate Metrics */}
                        <div className="glass-card p-6">
                            <h2 className="text-2xl font-semibold text-gray-800 mb-4">
                                <i className="fas fa-percentage mr-2 text-purple-600"></i>
                                Block B: Efficiency Rates
                            </h2>
                            <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                                {data.rateMetrics.map((metric, idx) => (
                                    <div key={idx} className={`metric-card glass-card p-4 ${getStatusBg(metric.status)}`}>
                                        <div className="flex justify-between items-start mb-2">
                                            <span className="text-sm font-medium text-gray-700">{metric.name}</span>
                                            <i className={`fas ${
                                                metric.status === 'green' ? 'fa-check-circle' :
                                                metric.status === 'yellow' ? 'fa-exclamation-circle' :
                                                'fa-times-circle'
                                            } ${getStatusColor(metric.status)}`}></i>
                                        </div>
                                        <div className="text-3xl font-bold text-gray-900 mb-1">
                                            {metric.value.toFixed(1)}%
                                        </div>
                                        <div className="text-xs text-gray-600">
                                            Threshold: {metric.threshold}%
                                        </div>
                                    </div>
                                ))}
                            </div>
                        </div>

                        {/* Block C: Coverage & Risk */}
                        <div className="glass-card p-6">
                            <h2 className="text-2xl font-semibold text-gray-800 mb-4">
                                <i className="fas fa-layer-group mr-2 text-purple-600"></i>
                                Block C: Coverage Analysis
                            </h2>
                            <div className="overflow-x-auto">
                                <table className="w-full">
                                    <thead>
                                        <tr className="border-b border-gray-200">
                                            <th className="text-left py-3 px-4 font-semibold text-gray-700">Scheme/Stage</th>
                                            <th className="text-right py-3 px-4 font-semibold text-gray-700">Required</th>
                                            <th className="text-right py-3 px-4 font-semibold text-gray-700">Available</th>
                                            <th className="text-right py-3 px-4 font-semibold text-gray-700">Coverage</th>
                                            <th className="text-center py-3 px-4 font-semibold text-gray-700">Status</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {data.coverageMetrics.map((item, idx) => (
                                            <tr key={idx} className="border-b border-gray-100 hover:bg-gray-50">
                                                <td className="py-3 px-4 font-medium text-gray-800">{item.scheme}</td>
                                                <td className="text-right py-3 px-4 text-gray-700">{item.required}</td>
                                                <td className="text-right py-3 px-4 text-gray-700 font-semibold">{item.available}</td>
                                                <td className="text-right py-3 px-4">
                                                    <span className={`font-bold ${getStatusColor(item.status)}`}>
                                                        {item.ratio.toFixed(2)}x
                                                    </span>
                                                </td>
                                                <td className="text-center py-3 px-4">
                                                    <span className={`inline-block px-3 py-1 rounded-full text-xs font-semibold ${getStatusBg(item.status)}`}>
                                                        {item.status === 'green' ? 'Good' : item.status === 'yellow' ? 'Watch' : 'Critical'}
                                                    </span>
                                                </td>
                                            </tr>
                                        ))}
                                    </tbody>
                                </table>
                            </div>
                        </div>

                        {/* Block D: Speed Metrics */}
                        <div className="glass-card p-6">
                            <h2 className="text-2xl font-semibold text-gray-800 mb-4">
                                <i className="fas fa-tachometer-alt mr-2 text-purple-600"></i>
                                Block D: Cycle Speed
                            </h2>
                            <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <div className="space-y-4">
                                    {data.speedMetrics.map((item, idx) => (
                                        <div key={idx} className="flex items-center justify-between p-4 bg-gray-50 rounded-lg">
                                            <div>
                                                <div className="font-semibold text-gray-800">{item.stage}</div>
                                                <div className="text-xs text-gray-600 mt-1">Target: {item.target} days</div>
                                            </div>
                                            <div className="text-right">
                                                <div className={`text-2xl font-bold ${getStatusColor(item.status)}`}>
                                                    {item.days}d
                                                </div>
                                                <div className="text-xs text-gray-600">
                                                    {item.days <= item.target ? '‚úì On track' : '‚ö† Delayed'}
                                                </div>
                                            </div>
                                        </div>
                                    ))}
                                </div>
                                <div>
                                    <ResponsiveContainer width="100%" height={300}>
                                        <BarChart data={data.cycleTimeHistory}>
                                            <CartesianGrid strokeDasharray="3 3" />
                                            <XAxis dataKey="cycle" />
                                            <YAxis />
                                            <Tooltip />
                                            <Legend />
                                            <Bar dataKey="sampling" stackId="a" fill="#667eea" name="Sampling" />
                                            <Bar dataKey="genotyping" stackId="a" fill="#764ba2" name="Genotyping" />
                                            <Bar dataKey="planning" stackId="a" fill="#f59e0b" name="Planning" />
                                        </BarChart>
                                    </ResponsiveContainer>
                                </div>
                            </div>
                        </div>

                        {/* Top Operational Issues */}
                        <div className="glass-card p-6">
                            <h2 className="text-2xl font-semibold text-gray-800 mb-4">
                                <i className="fas fa-exclamation-triangle mr-2 text-purple-600"></i>
                                Top Operational Issues
                            </h2>
                            <div className="space-y-3">
                                {data.topIssues.map((issue, idx) => (
                                    <div key={idx} className="flex items-center gap-4 p-4 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors">
                                        <div className="w-8 h-8 rounded-full bg-gradient-to-br from-purple-600 to-indigo-600 text-white flex items-center justify-center font-bold">
                                            {issue.rank}
                                        </div>
                                        <div className="flex-1">
                                            <div className="font-semibold text-gray-800">{issue.issue}</div>
                                            <div className="text-sm text-gray-600 mt-1">
                                                {issue.plants} plants affected ¬∑ {issue.pct}% of population
                                            </div>
                                        </div>
                                        <div className="text-right">
                                            <span className={`inline-block px-3 py-1 rounded-full text-xs font-semibold ${
                                                issue.impact === 'High' ? 'bg-status-red' :
                                                issue.impact === 'Medium' ? 'bg-status-yellow' : 'bg-status-green'
                                            }`}>
                                                {issue.impact} Impact
                                            </span>
                                            <div className="text-xs text-gray-600 mt-1">
                                                Trend: {issue.trend === 'increasing' ? 'üìà' : issue.trend === 'decreasing' ? 'üìâ' : '‚û°Ô∏è'} {issue.trend}
                                            </div>
                                        </div>
                                    </div>
                                ))}
                            </div>
                        </div>

                        {/* Block F: Stack Progress */}
                        <div className="glass-card p-6">
                            <h2 className="text-2xl font-semibold text-gray-800 mb-4">
                                <i className="fas fa-layer-group mr-2 text-purple-600"></i>
                                Block F: Trait Pyramiding Progress (Zn + QPM)
                            </h2>
                            <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                                {data.stackProgress.map((item, idx) => (
                                    <div key={idx} className="metric-card glass-card p-6 text-center">
                                        <div className="text-sm font-medium text-gray-600 mb-2">{item.level}</div>
                                        <div className="text-4xl font-bold text-purple-700 mb-2">{item.count}</div>
                                        <div className="text-xs text-gray-600">Target: {item.target}</div>
                                        <div className={`mt-3 text-sm font-semibold ${
                                            item.count >= item.target ? 'status-green' : 'status-yellow'
                                        }`}>
                                            {item.count >= item.target ? '‚úì Target achieved' : `${item.target - item.count} more needed`}
                                        </div>
                                    </div>
                                ))}
                            </div>
                        </div>

                        {/* Footer */}
                        <div className="glass-card p-4 text-center text-sm text-gray-600">
                            <p>
                                <i className="fas fa-database mr-2"></i>
                                Connected to BMS API ¬∑ Auto-refresh every 5 minutes when enabled
                            </p>
                            <p className="mt-2 text-xs">
                                <i className="fas fa-shield-alt mr-2"></i>
                                View-only access ¬∑ Contact admin for edit permissions
                            </p>
                        </div>
                    </div>
                </div>
            );
        };

        // Render the app
        ReactDOM.render(<Dashboard />, document.getElementById('root'));
    </script>
</body>
</html>
